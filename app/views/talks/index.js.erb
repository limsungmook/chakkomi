$(function(){
    $('.laydesk_body').hide().html('<%= escape_javascript(render('talk')) %>').show('slide');

	var intval = '';
	History.Adapter.bind(window, 'statechange', function(){
		clearInterval(intval);
	    });
	// 페이지를 떠나면 무조건 check_update 인터벌을 종료한다. 
	$('a').click(function(){
		clearInterval(intval);
	    });
	$(".talk_title").click(function() {
		History.pushState(null, document.title, this.href);
		return false;
	    });
	$("#new_talk").submit(function(){
		$('#talk_form').html('<br /><%= image_tag '/assets/loader.gif' %>');
		clearInterval(intval);
	    });

	$.extend({
	    check_update: function(){
		    $.get('<%= url_for :action => 'check_update' %>', function(retval){
			    if(retval == '1')
			    {
				clearInterval(intval);
				$.getScript('/talks');
			    }
			});
		},
	    start_interval: function(){
		    intval = setInterval(function(){
			    $.check_update()
			}, 30000);
		}//start_interval
	    });//extend
	
	$.start_interval();

// Text Field 에 디폴트 값 주기 + 마우스 오버시 사라지기
	$(".defaultText").focus(function(srcc)
				{
				    if ($(this).val() == $(this)[0].title)
				    {
					$(this).removeClass("defaultTextActive");
					$(this).val("");
				    }
				});
	
	$(".defaultText").blur(function()
			       {
				   if ($(this).val() == "")
				   {
				       $(this).addClass("defaultTextActive");
				       $(this).val($(this)[0].title);
				   }
			       });
	
	$(".defaultText").blur();        
// end of Text Field effect 
    });